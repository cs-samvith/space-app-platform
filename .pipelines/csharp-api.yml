name: csharp-api
identity:
  userAssignedIdentities:
    "/subscriptions/104f27c7-ec45-4c45-bb93-a29dbd5e44ba/resourcegroups/space-dev-platform/providers/Microsoft.ManagedIdentity/userAssignedIdentities/space-platform-dev-msi":
      {}
  type: UserAssigned
properties:
  environmentId: "/subscriptions/104f27c7-ec45-4c45-bb93-a29dbd5e44ba/resourceGroups/space-dev-platform/providers/Microsoft.App/managedEnvironments/space-platform-env"
  configuration:
    secrets:
      - name: acrpass
        value: ACRPASSWORD
    registries:
      - server: CONTAINERREGISTRY
        username: spacedevacr
        passwordSecretRef: acrpass
    activeRevisionsMode: "Multiple"
    ingress:
      external: true
      allowInsecure: true
      targetPort: 8080
      traffic:
        # - weight: 100
        #   revisionName: single-app--REVISIONSUFFIX
        #   label: production
        - latestRevision: true
          weight: 100
  template:
    revisionSuffix: REVISIONSUFFIX
    containers:
      - image: CONTAINERREGISTRY/IMAGENAME:TAG
        name: csharpapimain
        resources:
          cpu: 0.25
          memory: 0.5Gi
        limit:
          cpu: 0.25
          memory: 0.5Gi
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        probes:
          - type: Liveness
            httpGet:
              path: /liveness
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 10

          - type: Readiness
            httpGet:
              path: /readiness
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 20
    scale:
      minReplicas: 1
      maxReplicas: 10
